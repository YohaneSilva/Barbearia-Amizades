{% extends 'minha-conta/base.html' %}
{% load static %}
{% block title %} Relatórios | Barbearia Amizades S & D{% endblock %}
{% block module_title %}Relatórios{% endblock %}
{% block content %}
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script>
    $(document).ready(function(){
        $('#divRelatorioEspecialista').hide();
        $('#divRelatorioServico').hide();
        $("select#qualRelatorio").change(function(){
            var itemSelecionado = $(this).children("option:selected").val();
            
            if (itemSelecionado == 'Agendamentos por Serviço'){
                $('#divRelatorioEspecialista').hide();
                $('#divRelatorioServico').show();
            }else if (itemSelecionado == 'Agendamentos por Especialista') {
                $('#divRelatorioServico').hide();
                $('#divRelatorioEspecialista').show();
            }else {
                $('#divRelatorioEspecialista').hide();
                $('#divRelatorioServico').hide();
            }
        });
    });
</script>
  <div class="container-fluid">
    <!-- Modal de Mais Informações-->
    <div class="modal fade" id="modalAvaliacaoAtendimento" tabindex="-1" role="dialog" aria-labelledby="modalAvaliacaoAtendimento" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Avaliação do Cliente</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <strong>Cliente: </strong><span id="maisInformacoesNomeCliente"></span><br>
            <strong>Avaliação: </strong><span id="maisInformacoesAvaliacao"></span><br>
            <strong>Obsevações da Avaliação: </strong><span id="maisInformacoesObservacaoAvaliacao"></span><br>

            <hr>
            <h5 class="modal-title" id="exampleModalLongTitle">Mais Informações</h5>
            <br>

            <strong>Agendamento: </strong><span id="maisInformacoesDataAtendimento"></span><br>
            <strong>Período: </strong><span id="maisInformacoesPeriodoAtendimento"></span><br>
            <strong>Agendado em: </strong><span id="maisInformacoesAgendadoEm"></span><br>
            <strong>Situação: </strong><span id="maisInformacoesStatusAtendimento"></span><br>
            <strong>Observações do Agendamento: </strong><span id="maisInformacoesObservacaoAgendamento"></span><br>
            <strong>Observações do Especialista: </strong><span id="maisInformacoesObservacaoEspecialista"></span><br>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Botão pra atualizar a página -->
    <button class="btn btn-primary module-title" aria-label="Botão para atualizar tabela de agendamentos cadastrados" id="btnRefreshPage" title="Atualizar tabela de agendamentos">
      Atualizar Tabela
    </button>

    <form action="{% url 'relatorios' %}" method="POST">
        {% csrf_token %}
        <div class="row module-title">
            <div class="col-4">
                <label for="qualRelatorio">Qual o relatório: </label>
                <select id="qualRelatorio" name="qual-relatorio" onchange="verifica(this.value)" class="form-control">
                    <option selected>Todos</option>
                    <option>Agendamentos por Especialista</option>
                    <option>Agendamentos por Serviço</option>
                    <option>Agendamentos do Mês</option>
                    <option>Agendamentos Ativos</option>
                    <option>Agendamentos Finalizados</option>
                    <option>Agendamentos Cancelados</option>
                    <option>Agendamentos Cancelados Pelo Usuário</option>
                    <option>Agendamentos Cancelados Pelo Especialista</option>
                    <option>Agendamentos Pendentes</option>
                </select>
            </div>
            <div class="col-4" id="divRelatorioEspecialista">
                <label for="relatorioEspecialista">Qual o especialista: </label>
                <select id="relatorioEspecialista" name="especialista" class="form-control">
                    <option>Selecione um especialista</option>
                    <option>Chiquinho Oliveira</option>
                    <option>Sandrinho Santos</option>
                </select>
            </div>
            <div class="col-4" id="divRelatorioServico">
                <label for="relatorioServico">Qual o serviço: </label>
                <select id="relatorioServico" name="servico" class="form-control">
                    <option>Selecione um serviço</option>
                    {% for valor in servicos_cadastrados %}
                        <option>{{valor}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary module-title">Filtrar</button>
    </form>

    <p id="lengthRowTable"></p>

    <button type="submit" title="Exportar Relatório" class="btn btn-secondary module-title" form="formExportarRelatorio">Exportar Relatório</button>

  </div>
  <div id="listingTable" class="container-fluid">
    <div>
      {% for message in messages %}
        <div class="alert {{ message.tags }}" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Fechar mensagem">
                <span aria-hidden="true">&times;</span>
            </button>
            {{ message }}
        </div>
      {% endfor %}
    </div>
    <form action="{% url 'exportarRelatorio' %}" method="POST" id="formExportarRelatorio">
        {% csrf_token %}
        <table class="table table-striped table-dark table-hover text-center" id="tableAllResults">
            <thead>
                <tr>
                    <th colspan="12" class="align-middle">{{ relatorio_selecionado }}</th>
                </tr>
                <tr>
                    <th scope="col" class="align-middle">Avaliação</th>
                    <th scope="col" class="align-middle">Código</th>
                    <th scope="col" class="align-middle">Agendado <br> Em</th>
                    <th scope="col" class="align-middle">Nome</th>
                    <th scope="col" class="align-middle">Telefone</th>
                    <th scope="col" class="align-middle">E-mail</th>
                    <th scope="col" class="align-middle">Data <br> Atendimento</th>
                    <th scope="col" class="align-middle">Especialista <br> </th>
                    <th scope="col" class="align-middle">Período <br> Atendimento</th>
                    <th scope="col" class="align-middle">Serviço</th>
                    <th scope="col" class="align-middle">Situação</th>
                    <th scope="col" class="align-middle">Observações <br> Agendamento</th>
                </tr>
            </thead>
            <tbody>
                {% for valor in agendamentos_cadastrados %}
                    <tr data-toggle="modal" data-target="#modaEditDeleteBooking">
                        <td class="align-middle">
                            {% if valor.res_status == 'Finalizado'%}
                                <button type="button" id="btnMostrarAvaliacao" class="btn bg-warning text-white mr-2" title="Avaliação do Atendimento">
                                    <i class="fas fa-star"></i>
                                </button>
                            {% endif %}
                        </td>
                        <td class="align-middle" scope="row" id="codeBooking">
                            {{ valor.id }}
                            <input type="hidden" name="codigo" value="{{ valor.id }}">
                        </td>
                        <td class="align-middle" id="agendadoEm">
                            {{ valor.res_agendado_em }}
                            <input type="hidden" name="agendado-em" value="{{ valor.res_agendado_em }}">
                        </td>
                        <td class="align-middle" id="nomeCliente">
                            {{ valor.res_nome_cliente }}
                            <input type="hidden" name="nome-cliente" value="{{ valor.res_nome_cliente }}">
                        </td>
                        <td class="align-middle">
                            {{ valor.res_telefone_cliente }}
                            <input type="hidden" name="telefone-cliente" value="{{ valor.res_telefone_cliente }}">
                        </td>
                        <td class="align-middle" id="emailCliente">
                            {{ valor.res_email_cliente }}
                            <input type="hidden" name="email-cliente" value="{{ valor.res_email_cliente }}">
                        </td>
                        <td class="align-middle" id="dataAtendimento">
                            {{ valor.res_data_atendimento }}
                            <input type="hidden" name="data-atendimento" value="{{ valor.res_data_atendimento }}">
                        </td>
                        <td class="align-middle">
                            {{ valor.res_especialista }}
                            <input type="hidden" name="nome-especialista" value="{{ valor.res_especialista }}">
                        </td>
                        <td class="align-middle" id="periodoAtendimento">
                            {{ valor.res_periodo_atendimento }}
                            <input type="hidden" name="periodo-atendimento" value="{{ valor.res_periodo_atendimento }}">
                        </td>
                        <td class="align-middle">
                            {{ valor.res_servicos }}
                            <input type="hidden" name="servicos" value="{{ valor.res_servicos }}">
                        </td>
                        <td class="align-middle" id="statusAtendimento">
                            {{ valor.res_status }}
                            <input type="hidden" name="status-atendimento" value="{{ valor.res_status }}">
                        </td>
                        <td class="align-middle" id="observacaoAgendamento">
                            {{ valor.res_observacao }}
                            <input type="hidden" name="observacao-agendamento" value="{{ valor.res_observacao }}">
                        </td>
                        {% if valor.res_avaliacao == 0%}
                            <td hidden class="align-middle" id="avaliacaoCliente">
                                Sem avaliação
                                <input type="hidden" name="avaliacao-cliente" value="Sem avaliação">
                            </td>
                        {% else%}
                            <td hidden class="align-middle" id="avaliacaoCliente">
                                {{ valor.res_avaliacao }}
                                <input type="hidden" name="avaliacao-cliente" value="{{ valor.res_avaliacao }}">
                            </td>
                        {% endif %}
                        <td hidden class="align-middle" id="observacaoAvaliacaoCliente">
                            {{ valor.res_observacao_avaliacao }}
                            <input type="hidden" name="observacao-avaliacao-cliente" value="{{ valor.res_observacao_avaliacao }}">
                        </td>
                        <td hidden class="align-middle" id="observacaoEspecialista">
                            {{ valor.res_observacao_especialista }}
                            <input type="hidden" name="observacao-especialista" value="{{ valor.res_observacao_especialista }}">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
  </div>
{% endblock %}